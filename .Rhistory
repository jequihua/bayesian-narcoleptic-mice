setwd("D:/repositories/bayesian-narcoleptic-mice/")
# Load packages.
library("tidyverse")
library("ggplot2")
library("brms")
library("brmstools")
library("bayesplot")
library("emmeans")
library("tidybayes")
# Load misc. functions.
source("./R/misc_functions.R")
# Load recorded behaviors data.
data <- read_csv("./data/videos/recorded_behaviors.csv")
### Duration of each BA (narcoleptic attack) model.
ba_seconds <- filter(data,behavior=="BA")
# Change variable types.
ba_seconds$group <- as.factor(ba_seconds$group)
ba_seconds$mouse <- as.factor(ba_seconds$mouse)
# Which priors can we specify for our model?
get_prior(seconds ~ group + (1|mouse), data=ba_seconds)
# Fit brms model for duration of each BA attack.
ba_seconds_fit <- brm(seconds ~ group + (1|mouse),
data = ba_seconds,
family = gaussian,
control = list(adapt_delta = 0.999))
summary(ba_seconds_fit)
# Chart raw data boxplots.
ggplot(ba_seconds, aes(x=group, y=seconds)) + geom_boxplot(lwd=1.2)+
labs(x = NULL, y = "Seconds")+
ggtitle("Duration of each BA")+
theme_bw(base_size = 40)+
xlab("Groups")
ggsave("./images4/1_ba_duration/1_ba_duration_rawdata_boxplots.png",
width = 10, height = 8, dpi = 500,device="png")
ba_seconds_summary = summarise(ba_seconds_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(seconds),
median = median(seconds),
min=min(seconds),
max=max(seconds),
sd=sd(seconds),
q0.25=quantile(seconds,0.25),
q0.75=quntile(segonds,0.75),
IQR=IQR(seconds))
# Summary stats.
ba_seconds_grouped = group_by(ba_seconds,group)
ba_seconds_summary = summarise(ba_seconds_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(seconds),
median = median(seconds),
min=min(seconds),
max=max(seconds),
sd=sd(seconds),
q0.25=quantile(seconds,0.25),
q0.75=quntile(segonds,0.75),
IQR=IQR(seconds))
ba_seconds_summary = summarise(ba_seconds_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(seconds),
median = median(seconds),
min=min(seconds),
max=max(seconds),
sd=sd(seconds),
q0.25=quantile(seconds,0.25),
q0.75=quantile(segonds,0.75),
IQR=IQR(seconds))
ba_seconds_summary = summarise(ba_seconds_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(seconds),
median = median(seconds),
min=min(seconds),
max=max(seconds),
sd=sd(seconds),
q0.25=quantile(seconds,0.25),
q0.75=quantile(seconds,0.75),
IQR=IQR(seconds))
write_csv(ba_seconds_summary,"./images4/1_ba_duration/1_ba_duration_rawdata_summary.csv")
# Summary stats.
ba_seconds_grouped = group_by(ba_seconds,group)
ba_seconds_summary = summarise(ba_seconds_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(seconds),
median = median(seconds),
min=min(seconds),
max=max(seconds),
sd=sd(seconds),
Q0.25=quantile(seconds,0.25),
Q0.75=quantile(seconds,0.75),
IQR=IQR(seconds))
# Evaluate model fit.
summary(ba_seconds_fit)
plot(ba_seconds_fit)
# Predictive posterior checks.
pp <- brms::pp_check(ba_seconds_fit,nsamples=10)
pp + theme_bw()
# PP hist plot.
y_simulated <- posterior_predict(ba_seconds_fit, draws = 500)
ppc_hist(ba_seconds$seconds, y_simulated[1:11,], binwidth = 3)
# Conditional Predictions.
brms::marginal_effects(ba_seconds_fit)
### Total number of BA (narcoleptic attacks) cases model per hour.
# Poisson regression offset log(time)
# Table available number of hours-data per mice.
mice_totalhours <- group_by(data,mouse) %>%
summarise(totaltime = sum(seconds)/3600)
# Join data and mice_hours.
dataa <- right_join(data,mice_totalhours,by="mouse")
ba_counts <- dataa %>%
mutate(mouse=paste0(group," ",mouse)) %>%
group_by(mouse) %>%
summarise(BA_counts = sum(behavior == "BA"),hours=min(totaltime)) %>%
separate(mouse,c("group","mouse"))
# Change variable types.
ba_counts$group <- as.factor(ba_counts$group)
ba_counts$mouse <- as.factor(ba_counts$mouse)
# Which priors can we specify for our model?
get_prior(BA_counts ~ group + (1|mouse)+offset(log(hours)), data=ba_counts)
# Summary stats.
ba_counts_grouped = group_by(ba_counts,group)
ba_counts_summary = summarise(ba_counts_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(BA_counts),
median = median(BA_counts),
min=min(BA_counts),
max=max(BA_counts),
sd=sd(BA_counts),
Q0.25=quantile(seconds,0.25),
Q0.75=quantile(seconds,0.75),
IQR=IQR(seconds))
ba_counts_summary = summarise(ba_counts_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(BA_counts),
median = median(BA_counts),
min=min(BA_counts),
max=max(BA_counts),
sd=sd(BA_counts),
Q0.25=quantile(BA_counts,0.25),
Q0.75=quantile(BA_counts,0.75),
IQR=IQR(BA_counts))
write_csv(ba_counts_summary,"./images4/2_ba_counts/1_ba_counts_rawdata_summary.csv")
# Total hours of sampling by mouse.
mice_totalseconds <- group_by(data,mouse) %>%
summarise(totaltime = sum(seconds))
# Join data and mice_hours.
dataa <- right_join(data,mice_totalseconds,by="mouse")
ba_percentage <- filter(dataa,behavior=="BA") %>%
mutate(mouse=paste0(group," ",mouse)) %>%
group_by(mouse) %>%
summarise(BA_totaltime = sum(seconds),hours=min(totaltime)) %>%
mutate(percentage_time_BA=(BA_totaltime/hours)) %>%
separate(mouse,c("group","mouse"))
# Change variable types.
ba_percentage$group <- as.factor(ba_percentage$group)
ba_percentage$mouse <- as.factor(ba_percentage$mouse)
# Summary stats.
ba_percentage_grouped = group_by(ba_percentage,group)
ba_percentage_summary = summarise(ba_percentage_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(percentage_time_BA),
median = median(percentage_time_BA),
min=min(percentage_time_BA),
max=max(percentage_time_BA),
sd=sd(percentage_time_BA),
Q0.25=quantile(percentage_time_BA,0.25),
Q0.75=quantile(percentage_time_BA,0.75),
IQR=IQR(percentage_time_BA))
write_csv(ba_percentage_summary,"./images4/3_ba_percentage/1_ba_percentage_rawdata_summary.csv")
# Load packages.
library("tidyverse")
library("ggplot2")
library("brms")
library("bayesplot")
# Load recorded behaviors data.
rem <- read_csv("./data/eeg/eeg_rem_epochs.csv")
names(rem)[2]="seconds"
norem <- read_csv("./data/eeg/eeg_norem_epochs.csv")
names(norem)[2]="seconds"
wake <- read_csv("./data/eeg/eeg_wake_epochs.csv")
names(wake)[2]="seconds"
### Total time in REM model.
# Poisson regression offset log(time)
# Table available number of seconds-data per mice.
mice_totalhours <- group_by(rem,mouse) %>%
summarise(totaltime = sum(seconds))
# Join data and mice_hours.
dataa <- right_join(rem,mice_totalhours,by="mouse")
rem_counts <- dataa[!duplicated(dataa[,c("mouse","group")]),]
rem_counts$group[rem_counts$group=="silvestre"]="WT"
rem_counts$group[rem_counts$group=="txsham"]="sham"
# Change variable types.
rem_counts$group <- as.factor(rem_counts$group)
rem_counts$mouse <- as.factor(rem_counts$mouse)
rem_counts$group = factor(as.character(rem_counts$group), levels=c("WT","NB","sham","txcb","txox"))
# Summary stats.
rem_counts_grouped = group_by(rem_counts,group)
rem_counts_summary = summarise(rem_counts_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(totaltime),
median = median(totaltime),
min=min(totaltime),
max=max(totaltime),
sd=sd(totaltime),
Q0.25=quantile(totaltime,0.25),
Q0.75=quantile(totaltime,0.75),
IQR=IQR(totaltime))
write_csv(rem_counts_summary,"./images5/1_rem_Tseconds/1_rem_seconds_rawdata_summary.csv")
# Poisson regression offset log(time)
# Table available number of hours-data per mice.
mice_totalhours <- group_by(wake,mouse) %>%
summarise(totaltime = sum(seconds))
# Join data and mice_hours.
dataa <- right_join(wake,mice_totalhours,by="mouse")
rem_counts <- dataa[!duplicated(dataa[,c("mouse","group")]),]
rem_counts$group[rem_counts$group=="silvestre"]="WT"
rem_counts$group[rem_counts$group=="txsham"]="sham"
# Change variable types.
rem_counts$group <- as.factor(rem_counts$group)
rem_counts$mouse <- as.factor(rem_counts$mouse)
rem_counts$group = factor(as.character(rem_counts$group), levels=c("WT","NB","sham","txcb","txox"))
# Summary stats.
rem_counts_grouped = group_by(rem_counts,group)
rem_counts_summary = summarise(rem_counts_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(totaltime),
median = median(totaltime),
min=min(totaltime),
max=max(totaltime),
sd=sd(totaltime),
Q0.25=quantile(totaltime,0.25),
Q0.75=quantile(totaltime,0.75),
IQR=IQR(totaltime))
write_csv(rem_counts_summary,"./images5/2_wake_Tseconds/1_wake_seconds_rawdata_summary.csv")
# Poisson regression offset log(time)
# Table available number of hours-data per mice.
mice_totalhours <- group_by(norem,mouse) %>%
summarise(totaltime = sum(seconds))
# Join data and mice_hours.
dataa <- right_join(norem,mice_totalhours,by="mouse")
dataa
rem_counts <- dataa[!duplicated(dataa[,c("mouse","group")]),]
rem_counts$group[rem_counts$group=="silvestre"]="WT"
rem_counts$group[rem_counts$group=="txsham"]="sham"
head(rem_counts)
# Change variable types.
rem_counts$group <- as.factor(rem_counts$group)
rem_counts$mouse <- as.factor(rem_counts$mouse)
rem_counts$group = factor(as.character(rem_counts$group), levels=c("WT","NB","sham","txcb","txox"))
# Summary stats.
rem_counts_grouped = group_by(rem_counts,group)
write_csv(rem_counts_summary,"./images5/3_norem_Tseconds/1_norem_seconds_rawdata_summary.csv")
# Poisson regression offset log(time)
# Table available number of hours-data per mice.
mice_totalhours <- group_by(wake,mouse) %>%
summarise(totaltime = sum(seconds))
# Join data and mice_hours.
dataa <- right_join(wake,mice_totalhours,by="mouse")
rem_counts <- dataa[!duplicated(dataa[,c("mouse","group")]),]
rem_counts$group[rem_counts$group=="silvestre"]="WT"
rem_counts$group[rem_counts$group=="txsham"]="sham"
# Change variable types.
rem_counts$group <- as.factor(rem_counts$group)
rem_counts$mouse <- as.factor(rem_counts$mouse)
rem_counts$group = factor(as.character(rem_counts$group), levels=c("WT","NB","sham","txcb","txox"))
# Summary stats.
rem_counts_grouped = group_by(rem_counts,group)
rem_counts_summary = summarise(rem_counts_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(totaltime),
median = median(totaltime),
min=min(totaltime),
max=max(totaltime),
sd=sd(totaltime),
Q0.25=quantile(totaltime,0.25),
Q0.75=quantile(totaltime,0.75),
IQR=IQR(totaltime))
write_csv(rem_counts_summary,"./images5/2_wake_Tseconds/1_wake_seconds_rawdata_summary.csv")
# Poisson regression offset log(time)
# Table available number of hours-data per mice.
mice_totalhours <- group_by(norem,mouse) %>%
summarise(totaltime = sum(seconds))
# Join data and mice_hours.
dataa <- right_join(norem,mice_totalhours,by="mouse")
dataa
rem_counts <- dataa[!duplicated(dataa[,c("mouse","group")]),]
rem_counts$group[rem_counts$group=="silvestre"]="WT"
rem_counts$group[rem_counts$group=="txsham"]="sham"
head(rem_counts)
# Change variable types.
rem_counts$group <- as.factor(rem_counts$group)
rem_counts$mouse <- as.factor(rem_counts$mouse)
rem_counts$group = factor(as.character(rem_counts$group), levels=c("WT","NB","sham","txcb","txox"))
# Summary stats.
rem_counts_grouped = group_by(rem_counts,group)
rem_counts_summary = summarise(rem_counts_grouped,
n=n(),
n_mouse=n_distinct(mouse),
mean=mean(totaltime),
median = median(totaltime),
min=min(totaltime),
max=max(totaltime),
sd=sd(totaltime),
Q0.25=quantile(totaltime,0.25),
Q0.75=quantile(totaltime,0.75),
IQR=IQR(totaltime),
Q0.25=quantile(totaltime,0.25),
Q0.75=quantile(totaltime,0.75),
IQR=IQR(totaltime))
write_csv(rem_counts_summary,"./images5/3_norem_Tseconds/1_norem_seconds_rawdata_summary.csv")
